(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("addon/search/searchcursor",["../../lib/codemirror"],b):b(CodeMirror)})(function(b){function w(f,a){var c;c=f.flags;for(var e=c=null!=c?c:(f.ignoreCase?"i":"")+(f.global?"g":"")+(f.multiline?"m":""),d=0;d<a.length;d++)-1==e.indexOf(a.charAt(d))&&(e+=a.charAt(d));return c==e?f:new RegExp(f.source,e)}function z(f,a,c){a=w(a,"g");var e=c.line,d=c.ch;for(c=f.lastLine();e<=
c;e++,d=0)if(a.lastIndex=d,d=f.getLine(e),d=a.exec(d))return{from:k(e,d.index),to:k(e,d.index+d[0].length),match:d}}function l(f,a,c){if(!/\\s|\\n|\n|\\W|\\D|\[\^/.test(a.source))return z(f,a,c);a=w(a,"gm");for(var e,d=1,b=c.line,h=f.lastLine();b<=h;){for(var g=0;g<d&&!(b>h);g++){var r=f.getLine(b++);e=null==e?r:e+"\n"+r}d*=2;a.lastIndex=c.ch;if(g=a.exec(e))return a=e.slice(0,g.index).split("\n"),f=g[0].split("\n"),c=c.line+a.length-1,a=a[a.length-1].length,{from:k(c,a),to:k(c+f.length-1,1==f.length?
a+f[0].length:f[f.length-1].length),match:g}}}function n(f,a,c){for(var e,d=0;d<=f.length;){a.lastIndex=d;d=a.exec(f);if(!d)break;var b=d.index+d[0].length;if(b>f.length-c)break;if(!e||b>e.index+e[0].length)e=d;d=d.index+1}return e}function h(f,a,c){a=w(a,"g");var e=c.line,d=c.ch;for(c=f.firstLine();e>=c;e--,d=-1){var b=f.getLine(e);if(d=n(b,a,0>d?0:b.length-d))return{from:k(e,d.index),to:k(e,d.index+d[0].length),match:d}}}function q(f,a,c){if(!/\\s|\\n|\n|\\W|\\D|\[\^/.test(a.source))return h(f,
a,c);a=w(a,"gm");var e,d=1,b=f.getLine(c.line).length-c.ch;c=c.line;for(var l=f.firstLine();c>=l;){for(var g=0;g<d&&c>=l;g++){var r=f.getLine(c--);e=null==e?r:r+"\n"+e}d*=2;if(g=n(e,a,b))return a=e.slice(0,g.index).split("\n"),f=g[0].split("\n"),c+=a.length,a=a[a.length-1].length,{from:k(c,a),to:k(c+f.length-1,1==f.length?a+f[0].length:f[f.length-1].length),match:g}}}function p(f,a,c,b){if(f.length==a.length)return c;var d=0;for(a=c+Math.max(0,f.length-a.length);;){if(d==a)return d;var k=d+a>>1,h=
b(f.slice(0,k)).length;if(h==c)return k;h>c?a=k:d=k+1}}function v(f,a,c,b){if(!a.length)return null;b=b?x:y;a=b(a).split(/\r|\n\r?/);var d=c.line;c=c.ch;var h=f.lastLine()+1-a.length;a:for(;d<=h;d++,c=0){var l=f.getLine(d).slice(c),g=b(l);if(1==a.length){var r=g.indexOf(a[0]);if(-1==r)continue a;p(l,g,r,b);return{from:k(d,p(l,g,r,b)+c),to:k(d,p(l,g,r+a[0].length,b)+c)}}r=g.length-a[0].length;if(g.slice(r)!=a[0])continue a;for(var t=1;t<a.length-1;t++)if(b(f.getLine(d+t))!=a[t])continue a;var t=f.getLine(d+
a.length-1),D=b(t),A=a[a.length-1];if(D.slice(0,A.length)!=A)continue a;return{from:k(d,p(l,g,r,b)+c),to:k(d+a.length-1,p(t,D,A.length,b))}}}function u(b,a,c,e){if(!a.length)return null;e=e?x:y;a=e(a).split(/\r|\n\r?/);var d=c.line,h=c.ch,l=b.firstLine()-1+a.length;a:for(;d>=l;d--,h=-1){var g=b.getLine(d);-1<h&&(g=g.slice(0,h));h=e(g);if(1==a.length){c=h.lastIndexOf(a[0]);if(-1==c)continue a;return{from:k(d,p(g,h,c,e)),to:k(d,p(g,h,c+a[0].length,e))}}var r=a[a.length-1];if(h.slice(0,r.length)!=r)continue a;
var t=1;for(c=d-a.length+1;t<a.length-1;t++)if(e(b.getLine(c+t))!=a[t])continue a;c=b.getLine(d+1-a.length);t=e(c);if(t.slice(t.length-a[0].length)!=a[0])continue a;return{from:k(d+1-a.length,p(c,t,c.length-a[0].length,e)),to:k(d,p(g,h,r.length,e))}}}function m(b,a,c,e){this.afterEmptyMatch=this.atOccurrence=!1;this.doc=b;c=c?b.clipPos(c):k(0,0);this.pos={from:c,to:c};var d;"object"==typeof e?d=e.caseFold:(d=e,e=null);"string"==typeof a?(null==d&&(d=!1),this.matches=function(c,e){return(c?u:v)(b,
a,e,d)}):(a=w(a,"gm"),this.matches=e&&!1===e.multiline?function(c,d){return(c?h:z)(b,a,d)}:function(c,d){return(c?q:l)(b,a,d)})}var k=b.Pos,x,y;String.prototype.normalize?(x=function(b){return b.normalize("NFD").toLowerCase()},y=function(b){return b.normalize("NFD")}):(x=function(b){return b.toLowerCase()},y=function(b){return b});m.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(f){var a=this.doc.clipPos(f?this.pos.from:this.pos.to);
if(this.afterEmptyMatch&&this.atOccurrence&&(a=k(a.line,a.ch),f?(a.ch--,0>a.ch&&(a.line--,a.ch=(this.doc.getLine(a.line)||"").length)):(a.ch++,a.ch>(this.doc.getLine(a.line)||"").length&&(a.ch=0,a.line++)),0!=b.cmpPos(a,this.doc.clipPos(a))))return this.atOccurrence=!1;this.afterEmptyMatch=(a=this.matches(f,a))&&0==b.cmpPos(a.from,a.to);if(a)return this.pos=a,this.atOccurrence=!0,this.pos.match||!0;f=k(f?this.doc.firstLine():this.doc.lastLine()+1,0);this.pos={from:f,to:f};return this.atOccurrence=
!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(f,a){if(this.atOccurrence){var c=b.splitLines(f);this.doc.replaceRange(c,this.pos.from,this.pos.to,a);this.pos.to=k(this.pos.from.line+c.length-1,c[c.length-1].length+(1==c.length?this.pos.from.ch:0))}}};b.defineExtension("getSearchCursor",function(b,a,c){return new m(this.doc,b,a,c)});b.defineDocExtension("getSearchCursor",function(b,a,c){return new m(this,b,a,c)});
b.defineExtension("selectMatches",function(f,a){for(var c=[],e=this.getSearchCursor(f,this.getCursor("from"),a);e.findNext()&&!(0<b.cmpPos(e.to(),this.getCursor("to")));)c.push({anchor:e.from(),head:e.to()});c.length&&this.setSelections(c,0)})});
(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("addon/dialog/dialog",["../../lib/codemirror"],b):b(CodeMirror)})(function(b){function w(l,n,h){l=l.getWrapperElement();var q;q=l.appendChild(document.createElement("div"));q.className=h?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top";"string"==typeof n?q.innerHTML=n:q.appendChild(n);b.addClass(l,"dialog-opened");return q}
function z(b,n){b.state.currentNotificationClose&&b.state.currentNotificationClose();b.state.currentNotificationClose=n}b.defineExtension("openDialog",function(l,n,h){function q(k){if("string"==typeof k)m.value=k;else if(!v&&(v=!0,b.rmClass(p.parentNode,"dialog-opened"),p.parentNode.removeChild(p),u.focus(),h.onClose))h.onClose(p)}h||(h={});z(this,null);var p=w(this,l,h.bottom),v=!1,u=this,m=p.getElementsByTagName("input")[0];if(m){m.focus();h.value&&(m.value=h.value,!1!==h.selectValueOnOpen&&m.select());
if(h.onInput)b.on(m,"input",function(b){h.onInput(b,m.value,q)});if(h.onKeyUp)b.on(m,"keyup",function(b){h.onKeyUp(b,m.value,q)});b.on(m,"keydown",function(k){if(!(h&&h.onKeyDown&&h.onKeyDown(k,m.value,q))){if(27==k.keyCode||!1!==h.closeOnEnter&&13==k.keyCode)m.blur(),b.e_stop(k),q();13==k.keyCode&&n(m.value,k)}});if(!1!==h.closeOnBlur)b.on(p,"focusout",function(b){null!==b.relatedTarget&&q()})}else if(l=p.getElementsByTagName("button")[0]){b.on(l,"click",function(){q();u.focus()});if(!1!==h.closeOnBlur)b.on(l,
"blur",q);l.focus()}return q});b.defineExtension("openConfirm",function(l,n,h){function q(){v||(v=!0,b.rmClass(p.parentNode,"dialog-opened"),p.parentNode.removeChild(p),u.focus())}z(this,null);var p=w(this,l,h&&h.bottom);l=p.getElementsByTagName("button");var v=!1,u=this,m=1;l[0].focus();for(h=0;h<l.length;++h){var k=l[h];(function(h){b.on(k,"click",function(k){b.e_preventDefault(k);q();h&&h(u)})})(n[h]);b.on(k,"blur",function(){--m;setTimeout(function(){0>=m&&q()},200)});b.on(k,"focus",function(){++m})}});
b.defineExtension("openNotification",function(l,n){function h(){p||(p=!0,clearTimeout(v),b.rmClass(q.parentNode,"dialog-opened"),q.parentNode.removeChild(q))}z(this,h);var q=w(this,l,n&&n.bottom),p=!1,v,u=n&&"undefined"!==typeof n.duration?n.duration:5E3;b.on(q,"click",function(l){b.e_preventDefault(l);h()});u&&(v=setTimeout(h,u));return h})});
(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define("addon/search/search.js",["../../lib/codemirror","./searchcursor","../dialog/dialog"],b):b(CodeMirror)})(function(b){function w(g,a){"string"==typeof g?g=new RegExp(g.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),a?"gi":"g"):g.global||(g=new RegExp(g.source,g.ignoreCase?"gi":"g"));return{token:function(a){g.lastIndex=
a.pos;var b=g.exec(a.string);if(b&&b.index==a.pos)return a.pos+=b[0].length||1,"searching";b?a.pos=b.index:a.skipToEnd()}}}function z(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function l(g){return g.state.search||(g.state.search=new z)}function n(g){return"string"==typeof g&&g==g.toLowerCase()}function h(g,a,b){return g.getSearchCursor(a,b,{caseFold:n(a),multiline:!0})}function q(g,a,b,c,d){g.openDialog(a,c,{value:b,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){f(g)},
onKeyDown:d,bottom:g.options.search.bottom})}function p(g,a,b,c,d){g.openDialog?g.openDialog(a,d,{value:c,selectValueOnOpen:!0,bottom:g.options.search.bottom}):d(prompt(b,c))}function v(g,a,b,c){if(g.openConfirm)g.openConfirm(a,c);else if(confirm(b))c[0]()}function u(g){return g.replace(/\\([nrt\\])/g,function(g,a){return"n"==a?"\n":"r"==a?"\r":"t"==a?"\t":"\\"==a?"\\":g})}function m(g){var a=g.match(/^\/(.*)\/([a-z]*)$/);if(a)try{g=new RegExp(a[1],-1==a[2].indexOf("i")?"":"i")}catch(b){}else g=u(g);
if("string"==typeof g?""==g:g.test(""))g=/x^/;return g}function k(g,a,b){a.queryText=b;a.query=m(b);g.removeOverlay(a.overlay,n(a.query));a.overlay=w(a.query,n(a.query));g.addOverlay(a.overlay);g.showMatchesOnScrollbar&&(a.annotate&&(a.annotate.clear(),a.annotate=null),a.annotate=g.showMatchesOnScrollbar(a.query,n(a.query)))}function x(a,d,f,h){var e=l(a);if(e.query)return y(a,d);var m=a.getSelection()||e.lastQuery;m instanceof RegExp&&"x^"==m.source&&(m=null);if(f&&a.openDialog){var n=null,E=function(c,
d){b.e_stop(d);c&&(c!=e.queryText&&(k(a,e,c),e.posFrom=e.posTo=a.getCursor()),n&&(n.style.opacity=1),y(a,d.shiftKey,function(b,c){var d;3>c.line&&document.querySelector&&(d=a.display.wrapper.querySelector(".CodeMirror-dialog"))&&d.getBoundingClientRect().bottom-4>a.cursorCoords(c,"window").top&&((n=d).style.opacity=.4)}))};q(a,c(a),m,E,function(c,d){var e=b.keyName(c),f=a.getOption("extraKeys"),e=f&&f[e]||b.keyMap[a.getOption("keyMap")][e];if("findNext"==e||"findPrev"==e||"findPersistentNext"==e||
"findPersistentPrev"==e)b.e_stop(c),k(a,l(a),d),a.execCommand(e);else if("find"==e||"findPersistent"==e)b.e_stop(c),E(d,c)});h&&m&&(k(a,e,m),y(a,d))}else p(a,c(a),"Search for:",m,function(b){b&&!e.query&&a.operation(function(){k(a,e,b);e.posFrom=e.posTo=a.getCursor();y(a,d)})})}function y(a,c,d){a.operation(function(){var e=l(a),f=h(a,e.query,c?e.posFrom:e.posTo);if(!f.find(c)&&(f=h(a,e.query,c?b.Pos(a.lastLine()):b.Pos(a.firstLine(),0)),!f.find(c)))return;a.setSelection(f.from(),f.to());a.scrollIntoView({from:f.from(),
to:f.to()},20);e.posFrom=f.from();e.posTo=f.to();d&&d(f.from(),f.to())})}function f(a){a.operation(function(){var b=l(a);if(b.lastQuery=b.query)b.query=b.queryText=null,a.removeOverlay(b.overlay),b.annotate&&(b.annotate.clear(),b.annotate=null)})}function a(a,b){var c=a?document.createElement(a):document.createDocumentFragment(),d;for(d in b)c[d]=b[d];for(d=2;d<arguments.length;d++){var e=arguments[d];c.appendChild("string"==typeof e?document.createTextNode(e):e)}return c}function c(b){return a("",
null,a("span",{className:"CodeMirror-search-label"},b.phrase("Search:"))," ",a("input",{type:"text",style:"width: 10em",className:"CodeMirror-search-field"})," ",a("span",{style:"color: #888",className:"CodeMirror-search-hint"},b.phrase("(Use /re/ syntax for regexp search)")))}function e(b){return a("",null," ",a("input",{type:"text",style:"width: 10em",className:"CodeMirror-search-field"})," ",a("span",{style:"color: #888",className:"CodeMirror-search-hint"},b.phrase("(Use /re/ syntax for regexp search)")))}
function d(b){return a("",null,a("span",{className:"CodeMirror-search-label"},b.phrase("Replace?"))," ",a("button",{},b.phrase("Yes"))," ",a("button",{},b.phrase("No"))," ",a("button",{},b.phrase("All"))," ",a("button",{},b.phrase("Stop")))}function B(a,b,c){a.operation(function(){for(var d=h(a,b);d.findNext();)if("string"!=typeof b){var e=a.getRange(d.from(),d.to()).match(b);d.replace(c.replace(/\$(\d)/g,function(a,b){return e[b]}))}else d.replace(c)})}function C(b,c){if(!b.getOption("readOnly")){var k=
b.getSelection()||l(b).lastQuery,n=c?b.phrase("Replace all:"):b.phrase("Replace:"),q=a("",null,a("span",{className:"CodeMirror-search-label"},n),e(b));p(b,q,n,k,function(e){e&&(e=m(e),p(b,a("",null,a("span",{className:"CodeMirror-search-label"},b.phrase("With:"))," ",a("input",{type:"text",style:"width: 10em",className:"CodeMirror-search-field"})),b.phrase("Replace with:"),"",function(a){a=u(a);if(c)B(b,e,a);else{f(b);var k=h(b,e,b.getCursor("from")),l=function(){var c=k.from(),f;if(!(f=k.findNext())&&
(k=h(b,e),!(f=k.findNext())||c&&k.from().line==c.line&&k.from().ch==c.ch))return;b.setSelection(k.from(),k.to());b.scrollIntoView({from:k.from(),to:k.to()});v(b,d(b),b.phrase("Replace?"),[function(){m(f)},l,function(){B(b,e,a)}])},m=function(b){k.replace("string"==typeof e?a:a.replace(/\$(\d)/g,function(a,c){return b[c]}));l()};l()}}))})}}b.defineOption("search",{bottom:!1});b.commands.find=function(a){f(a);x(a)};b.commands.findPersistent=function(a){f(a);x(a,!1,!0)};b.commands.findPersistentNext=
function(a){x(a,!1,!0,!0)};b.commands.findPersistentPrev=function(a){x(a,!0,!0,!0)};b.commands.findNext=x;b.commands.findPrev=function(a){x(a,!0)};b.commands.clearSearch=f;b.commands.replace=C;b.commands.replaceAll=function(a){C(a,!0)}});(function(b){"function"==typeof b.define&&b.define("addonSearch",["addon/search/search.js"],function(){})})(this);