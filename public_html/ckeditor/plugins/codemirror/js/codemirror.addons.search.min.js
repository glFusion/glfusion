(function(c){"object"==typeof exports&&"object"==typeof module?c(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],c):c(CodeMirror)})(function(c){function w(c,n,f){var h;return h=c.getWrapperElement().appendChild(document.createElement("div")),h.className=f?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof n?h.innerHTML=n:h.appendChild(n),h}function z(c,n){c.state.currentNotificationClose&&c.state.currentNotificationClose();
c.state.currentNotificationClose=n}c.defineExtension("openDialog",function(p,n,f){function h(c){if("string"==typeof c)g.value=c;else if(!u&&(u=!0,q.parentNode.removeChild(q),v.focus(),f.onClose))f.onClose(q)}var g;f||(f={});z(this,null);var q=w(this,p,f.bottom),u=!1,v=this;if(g=q.getElementsByTagName("input")[0],g){if(g.focus(),f.value&&(g.value=f.value,!1!==f.selectValueOnOpen&&g.select()),f.onInput)c.on(g,"input",function(c){f.onInput(c,g.value,h)});if(f.onKeyUp)c.on(g,"keyup",function(c){f.onKeyUp(c,
g.value,h)});c.on(g,"keydown",function(m){f&&f.onKeyDown&&f.onKeyDown(m,g.value,h)||((27==m.keyCode||!1!==f.closeOnEnter&&13==m.keyCode)&&(g.blur(),c.e_stop(m),h()),13==m.keyCode&&n(g.value,m))});if(!1!==f.closeOnBlur)c.on(g,"blur",h)}else if(p=q.getElementsByTagName("button")[0]){c.on(p,"click",function(){h();v.focus()});if(!1!==f.closeOnBlur)c.on(p,"blur",h);p.focus()}return h});c.defineExtension("openConfirm",function(p,n,f){function h(){u||(u=!0,q.parentNode.removeChild(q),v.focus())}var g;z(this,
null);var q=w(this,p,f&&f.bottom);f=q.getElementsByTagName("button");var u=!1,v=this,m=1;f[0].focus();for(p=0;p<f.length;++p)g=f[p],function(f){c.on(g,"click",function(m){c.e_preventDefault(m);h();f&&f(v)})}(n[p]),c.on(g,"blur",function(){--m;setTimeout(function(){0>=m&&h()},200)}),c.on(g,"focus",function(){++m})});c.defineExtension("openNotification",function(p,n){function f(){g||(g=!0,clearTimeout(q),h.parentNode.removeChild(h))}z(this,f);var h=w(this,p,n&&n.bottom),g=!1,q,u=n&&"undefined"!=typeof n.duration?
n.duration:5E3;c.on(h,"click",function(g){c.e_preventDefault(g);f()});return u&&(q=setTimeout(f,u)),f})});
(function(c){"object"==typeof exports&&"object"==typeof module?c(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],c):c(CodeMirror)})(function(c){function w(k,a){return"string"==typeof k?k=new RegExp(k.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),a?"gi":"g"):k.global||(k=new RegExp(k.source,k.ignoreCase?"gi":"g")),{token:function(a){k.lastIndex=
a.pos;var b=k.exec(a.string);if(b&&b.index==a.pos)return a.pos+=b[0].length||1,"searching";b?a.pos=b.index:a.skipToEnd()}}}function z(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function p(k){return k.state.search||(k.state.search=new z)}function n(k){return"string"==typeof k&&k==k.toLowerCase()}function f(k,a,b){return k.getSearchCursor(a,b,{caseFold:n(a),multiline:!0})}function h(k,a,d,c,t){k.openDialog(a,c,{value:d,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){b(k)},
onKeyDown:t})}function g(k,a,b,d,c){k.openDialog?k.openDialog(a,c,{value:d,selectValueOnOpen:!0}):c(prompt(b,d))}function q(a,b,d,c){a.openConfirm?a.openConfirm(b,c):confirm(d)&&c[0]()}function u(a){return a.replace(/\\(.)/g,function(a,k){return"n"==k?"\n":"r"==k?"\r":k})}function v(a){var b=a.match(/^\/(.*)\/([a-z]*)$/);if(b)try{a=new RegExp(b[1],-1==b[2].indexOf("i")?"":"i")}catch(d){}else a=u(a);return("string"==typeof a?""==a:a.test(""))&&(a=/x^/),a}function m(a,b,d){b.queryText=d;b.query=v(d);
a.removeOverlay(b.overlay,n(b.query));b.overlay=w(b.query,n(b.query));a.addOverlay(b.overlay);a.showMatchesOnScrollbar&&(b.annotate&&(b.annotate.clear(),b.annotate=null),b.annotate=a.showMatchesOnScrollbar(b.query,n(b.query)))}function x(a,b,d,e){var r=p(a),l,f,A;if(r.query)return y(a,b);l=a.getSelection()||r.lastQuery;d&&a.openDialog?(f=null,A=function(b,d){(c.e_stop(d),b)&&(b!=r.queryText&&(m(a,r,b),r.posFrom=r.posTo=a.getCursor()),f&&(f.style.opacity=1),y(a,d.shiftKey,function(b,d){var c;3>d.line&&
document.querySelector&&(c=a.display.wrapper.querySelector(".CodeMirror-dialog"))&&c.getBoundingClientRect().bottom-4>a.cursorCoords(d,"window").top&&((f=c).style.opacity=.4)}))},h(a,t,l,A,function(b,d){var t=c.keyName(b),e=c.keyMap[a.getOption("keyMap")][t];e||(e=a.getOption("extraKeys")[t]);"findNext"==e||"findPrev"==e||"findPersistentNext"==e||"findPersistentPrev"==e?(c.e_stop(b),m(a,p(a),d),a.execCommand(e)):("find"==e||"findPersistent"==e)&&(c.e_stop(b),A(d,b))}),e&&l&&(m(a,r,l),y(a,b))):g(a,
t,"Search for:",l,function(d){d&&!r.query&&a.operation(function(){m(a,r,d);r.posFrom=r.posTo=a.getCursor();y(a,b)})})}function y(a,b,d){a.operation(function(){var t=p(a),e=f(a,t.query,b?t.posFrom:t.posTo);(e.find(b)||(e=f(a,t.query,b?c.Pos(a.lastLine()):c.Pos(a.firstLine(),0)),e.find(b)))&&(a.setSelection(e.from(),e.to()),a.scrollIntoView({from:e.from(),to:e.to()},20),t.posFrom=e.from(),t.posTo=e.to(),d&&d(e.from(),e.to()))})}function b(a){a.operation(function(){var b=p(a);(b.lastQuery=b.query,b.query)&&
(b.query=b.queryText=null,a.removeOverlay(b.overlay),b.annotate&&(b.annotate.clear(),b.annotate=null))})}function a(a,b,d){a.operation(function(){for(var c,e=f(a,b);e.findNext();)"string"!=typeof b?(c=a.getRange(e.from(),e.to()).match(b),e.replace(d.replace(/\$(\d)/g,function(a,b){return c[b]}))):e.replace(d)})}function d(d,c){if(!d.getOption("readOnly")){var t=d.getSelection()||p(d).lastQuery,m='\x3cspan class\x3d"CodeMirror-search-label"\x3e'+(c?"Replace all:":"Replace:")+"\x3c/span\x3e";g(d,m+
e,m,t,function(e){e&&(e=v(e),g(d,l,"Replace with:","",function(t){if(t=u(t),c)a(d,e,t);else{b(d);var l=f(d,e,d.getCursor("from")),m=function(){var b=l.from(),c;!(c=l.findNext())&&(l=f(d,e),!(c=l.findNext())||b&&l.from().line==b.line&&l.from().ch==b.ch)||(d.setSelection(l.from(),l.to()),d.scrollIntoView({from:l.from(),to:l.to()}),q(d,A,"Replace?",[function(){g(c)},m,function(){a(d,e,t)}]))},g=function(a){l.replace("string"==typeof e?t:t.replace(/\$(\d)/g,function(b,d){return a[d]}));m()};m()}}))})}}
var t='\x3cspan class\x3d"CodeMirror-search-label"\x3eSearch:\x3c/span\x3e \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',e=' \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',l='\x3cspan class\x3d"CodeMirror-search-label"\x3eWith:\x3c/span\x3e \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e',
A='\x3cspan class\x3d"CodeMirror-search-label"\x3eReplace?\x3c/span\x3e \x3cbutton\x3eYes\x3c/button\x3e \x3cbutton\x3eNo\x3c/button\x3e \x3cbutton\x3eAll\x3c/button\x3e \x3cbutton\x3eStop\x3c/button\x3e';c.commands.find=function(a){b(a);x(a)};c.commands.findPersistent=function(a){b(a);x(a,!1,!0)};c.commands.findPersistentNext=function(a){x(a,!1,!0,!0)};c.commands.findPersistentPrev=function(a){x(a,!0,!0,!0)};c.commands.findNext=x;c.commands.findPrev=function(a){x(a,!0)};c.commands.clearSearch=b;
c.commands.replace=d;c.commands.replaceAll=function(a){d(a,!0)}});
(function(c){"object"==typeof exports&&"object"==typeof module?c(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],c):c(CodeMirror)})(function(c){function w(b){if(!b.global){var a=b.flags;b=new RegExp(b.source,(null!=a?a:(b.ignoreCase?"i":"")+(b.global?"g":"")+(b.multiline?"m":""))+"g")}return b}function z(b,a,d){var c,e;a=w(a);var l=d.line;d=d.ch;for(var f=b.lastLine();l<=f;l++,d=0)if(a.lastIndex=d,c=b.getLine(l),e=a.exec(c),e)return{from:m(l,
e.index),to:m(l,e.index+e[0].length),match:e}}function p(b,a,d){var c,e,l,f,k,g,h;if(!/\\s|\\n|\n|\\W|\\D|\[\^/.test(a.source))return z(b,a,d);a=w(a);e=1;l=d.line;for(f=b.lastLine();l<=f;){for(k=0;k<e;k++)g=b.getLine(l++),c=null==c?g:c+"\n"+g;if(e*=2,a.lastIndex=d.ch,h=a.exec(c),h)return a=c.slice(0,h.index).split("\n"),b=h[0].split("\n"),d=d.line+a.length-1,a=a[a.length-1].length,{from:m(d,a),to:m(d+b.length-1,1==b.length?a+b[0].length:b[b.length-1].length),match:h}}}function n(b,a){for(var d=0,
c,e;;)if((a.lastIndex=d,e=a.exec(b),!e)||(c=e,d=c.index+(c[0].length||1),d==b.length))return c}function f(b,a,d){var c,e;a=w(a);var l=d.line;d=d.ch;for(var f=b.firstLine();l>=f;l--,d=-1)if(c=b.getLine(l),-1<d&&(c=c.slice(0,d)),e=n(c,a),e)return{from:m(l,e.index),to:m(l,e.index+e[0].length),match:e}}function h(b,a,d){var c,e,l,f,k,g,h;a=w(a);e=1;l=d.line;for(f=b.firstLine();l>=f;){for(k=0;k<e;k++)g=b.getLine(l--),c=null==c?g.slice(0,d.ch):g+"\n"+c;if(e*=2,h=n(c,a),h)return a=c.slice(0,h.index).split("\n"),
b=h[0].split("\n"),l+=a.length,a=a[a.length-1].length,{from:m(l,a),to:m(l+b.length-1,1==b.length?a+b[0].length:b[b.length-1].length),match:h}}}function g(b,a,d){var c;if(b.length==a.length)return d;for(a=Math.min(d,b.length);;)if(c=b.slice(0,a).toLowerCase().length,c<d)++a;else if(c>d)--a;else return a}function q(b,a,d,c){var e,l,f,k;if(!a.length)return null;c=c?x:y;a=c(a).split(/\r|\n\r?/);var h=d.line,n=d.ch,p=b.lastLine()+1-a.length;a:for(;h<=p;h++,n=0){if(e=b.getLine(h).slice(n),d=c(e),1==a.length){if(l=
d.indexOf(a[0]),-1==l)continue a;return g(e,d,l),{from:m(h,g(e,d,l)+n),to:m(h,g(e,d,l+a[0].length)+n)}}if(f=d.length-a[0].length,d.slice(f)==a[0]){for(k=1;k<a.length-1;k++)if(c(b.getLine(h+k))!=a[k])continue a;k=b.getLine(h+a.length-1);var r=c(k),q=a[a.length-1];if(k.slice(0,q.length)==q)return{from:m(h,g(e,d,f)+n),to:m(h+a.length-1,g(k,r,q.length))}}}}function u(b,a,d,c){var e,f,h,k,n,p,q;if(!a.length)return null;c=c?x:y;a=c(a).split(/\r|\n\r?/);var r=d.line;d=d.ch;var u=b.firstLine()-1+a.length;
a:for(;r>=u;r--,d=-1){if(e=b.getLine(r),-1<d&&(e=e.slice(0,d)),f=c(e),1==a.length){if(h=f.lastIndexOf(a[0]),-1==h)continue a;return{from:m(r,g(e,f,h)),to:m(r,g(e,f,h+a[0].length))}}if(k=a[a.length-1],f.slice(0,k.length)==k){n=1;for(d=r-a.length+1;n<a.length-1;n++)if(c(b.getLine(d+n))!=a[n])continue a;if(p=b.getLine(r+1-a.length),q=c(p),q.slice(q.length-a[0].length)==a[0])return{from:m(r+1-a.length,g(p,q,p.length-a[0].length)),to:m(r,g(e,f,k.length))}}}}function v(b,a,c,g){this.atOccurrence=!1;this.doc=
b;c=c?b.clipPos(c):m(0,0);this.pos={from:c,to:c};var e;"object"==typeof g?e=g.caseFold:(e=g,g=null);"string"==typeof a?(null==e&&(e=!1),this.matches=function(c,d){return(c?u:q)(b,a,d,e)}):(a=w(a),this.matches=g&&!1===g.multiline?function(c,d){return(c?f:z)(b,a,d)}:function(c,d){return(c?h:p)(b,a,d)})}var m=c.Pos,x,y;String.prototype.normalize?(x=function(b){return b.normalize("NFD").toLowerCase()},y=function(b){return b.normalize("NFD")}):(x=function(b){return b.toLowerCase()},y=function(b){return b});
v.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(b){for(var a=this.matches(b,this.doc.clipPos(b?this.pos.from:this.pos.to)),d;a&&0==c.cmpPos(a.from,a.to);)b?a.from.ch?a.from=m(a.from.line,a.from.ch-1):a=a.from.line==this.doc.firstLine()?null:this.matches(b,this.doc.clipPos(m(a.from.line-1))):a.to.ch<this.doc.getLine(a.to.line).length?a.to=m(a.to.line,a.to.ch+1):a=a.to.line==this.doc.lastLine()?null:this.matches(b,m(a.to.line+1,0));
return a?(this.pos=a,this.atOccurrence=!0,this.pos.match||!0):(d=m(b?this.doc.firstLine():this.doc.lastLine()+1,0),this.pos={from:d,to:d},this.atOccurrence=!1)},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(b,a){if(this.atOccurrence){var d=c.splitLines(b);this.doc.replaceRange(d,this.pos.from,this.pos.to,a);this.pos.to=m(this.pos.from.line+d.length-1,d[d.length-1].length+(1==d.length?this.pos.from.ch:0))}}};c.defineExtension("getSearchCursor",
function(b,a,c){return new v(this.doc,b,a,c)});c.defineDocExtension("getSearchCursor",function(b,a,c){return new v(this,b,a,c)});c.defineExtension("selectMatches",function(b,a){for(var d=[],f=this.getSearchCursor(b,this.getCursor("from"),a);f.findNext()&&!(0<c.cmpPos(f.to(),this.getCursor("to")));)d.push({anchor:f.from(),head:f.to()});d.length&&this.setSelections(d,0)})});